<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html lang="en">
<head>
<meta charset="utf-8" />

<title>Saving My Time Using Scripts</title>
<meta name="description" content="Session slides for UK2013" />
<meta name="author" content="Christoph Stoettner" />

<link href="http://fonts.googleapis.com/css?family=Open+Sans:regular,semibold,italic,italicsemibold|PT+Sans:400,700,400italic,700italic|PT+Serif:400,700,400italic,700italic" rel="stylesheet" />

<link rel="stylesheet" href="css/default.css" />

<script type="text/javascript" src="scripts/shCore.js"></script>
<script type="text/javascript" src="scripts/shBrushBash.js"></script>
<script type="text/javascript" src="scripts/shBrushJava.js"></script>
<script type="text/javascript" src="scripts/shBrushJython.js"></script>
<script type="text/javascript">SyntaxHighlighter.all();</script>
<link type="text/css" rel="stylesheet" href="styles/shCoreDefault.css"/>
<link href="css/stoeps.css" rel="stylesheet" />
<!--<link href="css/print.css" rel="stylesheet" type="text/css" media="print" />-->

</head>
<body>
<div id="impress" class="impress-enabled" >
    <!-- Fallback message if JS and CSS Transmission not supported -->
    <div class="fallback-message">
        <p>Your browser <b>doesn't support the features required</b>by impress.js, so you are presented with a simplified version of this presentation.</p>
        <p>For the best experience please use the latest <b>Chrome</b> or <b>Safari</b> browser. Firefox 10 (to be released soon) will also handle it.</p>
    </div>

    <!--div id="intro" class="step slidenobg" data-y="0" data-x="-1100" data-scale="1" data-z="90">
        <video width="640" height="480" controls>
          <source src="media/monty_python_milkman.mp4" type="video/mp4">
        </video> 
    </div-->

    <!-- Title "Slide" -->
    <div id="title" class="step slide" data-scale=4 data-x="-4000" data-y="1000" data-z="100"  >
        <img src="images/iconuk-logo-color.png" />
        <h1>Saving My Time Using Scripts</h1>
        <h2>Speed up IBM Connections(, Sametime & WebSphere)<br />Administration and Configuration</h2>
        <h3><a href="http://www.stoeps.de" target="_blank">Christoph Stoettner</a></h3>
        <h4><a href="http://www.fum.de" target="_blank">FRITZ & MACZIOL</a><br />
            <a href="http://about.me/stoeps" target="_blank">about.me/stoeps</a></h4>
    </div>

    <div id="agenda" class="step slide sideimg" data-x="0" data-y="0" data-scale="1.5">
        <h1>Agenda</h1>
        <ul>
            <li>Administration of IBM Connections</li>
            <ul>
                <li>Integrated Solution Console - ISC</li>
                <li>wsadmin</li>
            </ul>
            <li>WebSphere Application Server</li>
            <li>DB2</li>
            <li>Little bit more</li>
        </ul>
        <img src="images/hour-glass_2189255.jpg"/>
    </div>   

    <div class="step slide" data-x="1500">
        <h1>Caution</h1>
        <ul>
            <li>With scripts</li>
            <ul>
                <li>Shell</li>
                <li>Jython</li>
                <li>Powershell | Batch</li>
                <li>SQL</li>
            </ul>
            <li>You can...</li>
            <ul>
                <li>Save a lot of time</li>
                <li>change lots of stuff in seconds</li>
            </ul>
        </div>
        <div class="step slide sideimg" data-x="1500" data-y="1000">
            <h1>Disclaimer</h1>
            <p class="alert">Use all scripts i show in this slides or you download from my repositories WITHOUT WARRANTY and on your own risk!</p>
            <ul>
                <li>Tipps:</li>
                <ul> 
                    <li>Be Careful! Think twice!</li>
                    <li>Create Backups</li>
                    <li>Create a Testsystem</li>
                    <li>Make a documentation of your changes</li>
                </ul>
            </ul>
        </ul>
        <img src="images/caution.png" />
    </div>

    <div class="step slide subhead" data-x="3000" data-y="0">
        <h1>IBM Connections Administration</h1>
    </div>
    <div class="step slide img" data-x="3000" data-y="1000">
        <img src="images/isc_big.png" />
    </div>

    <div class="step slide img" data-x="3000" data-y="2000">
        <img src="images/ibm-mouse-CCBY-NC-SA2.0.jpg" />
    </div>

    <div class="step slide" data-x="3000" data-y="3000">
        <h1>Integrated Solution Console</h1>
        <ul>
            <li>Browserbased GUI for IBM WebSphere Application Server</li>
            <li>My Mouse pointer runs miles during a Connections Installation</li>
            <ul>
                <li>99% on Postinstall Tasks within ISC</li>
            </ul>
            <li><span style="text-decoration: line-through">&nbsp; Some </span> &nbsp; tasks are boring</li>
            <ul>
                <li>Performance Tuning of DataSources</li>
                <li>Setting Roles on Applications</li>
            </ul>
        </ul>
    </div>

    <div class="step slide nobg" data-x="3000" data-y="4000">

        <h1>Edit LotusConnections-config.xml</h1>
        <h2>Starting wsadmin</h2>
        <pre class="brush: bash">
            cd /opt/IBM/WebSphere/AppServer/profiles/Dmgr01/bin
            [root@cnxwas1 bin]$ ./wsadmin.sh -lang jython -username wasadmin -password password
        </pre>
    </div>

    <div class="step slide nobg" data-x="3000" data-y="4300">
        <h2>Type or paste your commands</h2>
        <pre class="brush: jython;highlight:[4,6,8,10]">    
            WASX7209I: Connected to process "dmgr" on node cnxwas1CellManager01 using SOAP
            connector; The type of process is: DeploymentManager
            WASX7031I: For help, enter: "print Help.help()"
            wsadmin>AdminControl.getCell()
            'cnxwas1Cell01'
            wsadmin>execfile("connectionsConfig.py")
            Connections Administration initialized
            wsadmin>LCConfigService.checkOutConfig('/tmp','cnxwas1Cell01')
            # Edit /tmp/LotusConnections-config.xml and save your changes
            wsadmin>LCConfigService.checkInConfig('/tmp','cnxwas1Cell01')
            Loading schema file for validation: /tmp/LotusConnections-config.xsd
            Loading schema file for validation: /tmp/service-location.xsd
            /tmp/LotusConnections-config.xml is valid
            Connections configuration file successfully checked in
        </pre>
    </div>

    <div class="step slide nobg" data-x="3000" data-y="5000">
        <h1>Synchronize ExID with LDAP</h1>
        <h2>News: Not case sensitiv</h2>
        <pre class="brush: jython;highlight: [1,3]">
            wsadmin>execfile("newsAdmin.py")
            Connecting to NewsMemberServiceName: News Configuration Environment initialized
            wsadmin>NewsMemberService.syncMemberExtIdByEmail("cstoettner@stoeps.local")
            syncMemberExtIdByEmail request processed
        </pre>
    </div>

    <div class="step slide nobg" data-x="3000" data-y="5350">
        <h2>Type or paste your commands</h2>
        <h2>Blogs: Case sensitive</h2>
        <pre class="brush: jython; highlight: [1,3,9]">
            wsadmin>execfile("blogsAdmin.py")
            Connecting to {...} Blogs Administration initialized
            wsadmin>BlogsMemberService.syncMemberExtIdByEmail("christoph.stoettner@stoeps.local")
            WASX70115E: Exception running command:
            "BlogsMemberSErvice.syncMemberExtIdByEmail("cstoettner@stoeps.local")";
            exception information:
            There is no member associated with this email address or login name:
            cstoettner@stoeps.local
            wsadmin>BlogsMemberService.syncMemberExtIdByEmail("CStoettner@stoeps.local")
            syncMemberExtIdByEmail request processed
        </pre>
    </div>

    <div class="step slide" data-x="3000" data-y="6200">
        <h1>Summary wsadmin</h1>
        <ul style="width:600px;float:left">
            <li>Complicated</li>
            <li>long commands</li>
            <li>case sensitiv</li>
            <ul>
                <li>jython commands</li>
                <li>sometimes also parameters!</li>
            </ul>
            <li>within Linux no history to recall commands</li>
        </ul>
        <img src="images/casesensitiv.png" />
    </div>

    <div class="step slide sideimg" data-x="4500" data-y="0">
        <h1>Agenda</h1>
        <ul>
            <li>Administration of IBM Connections</li>
            <li>WebSphere Application Server</li>
            <ul>
                <li>Wsadmin Properties</li>
                <li>Jython Basics</li>
                <li>Useful Scripts</li>
            </ul>
            <li>DB2</li>
            <li>Little bit more</li>
        </ul>
        <img src="images/hour-glass_2189255.jpg"/>
    </div>

    <div class="step slide subhead" data-x="4500" data-y="1000">
        <h1>IBM WebSphere Application Server Scripting</h1>
    </div>

    <div class="step slide" data-x="4500" data-y="2000">
        <h1>wsadmin Properties - Command Line</h1>
        <ul>
            <li>Always execute wsadmin on your Deployment Manager in the bin directory</li>
            <li class="code"><pre class="brush: bash;gutter: false">cd {WAS_HOME}/profiles/Dmgr01/bin</pre></li>
            <li>Linux | AIX</li>
            <ul>
                <li class="code"><pre class="brush: bash;gutter: false">./wsadmin.sh -lang {jython | jacl} -username wasadmin -password password</pre></li>
            </ul>
            <li>Windows</li>
            <ul>
                <li class="code"><pre class="brush: bash;gutter: false">wsadmin.bat -lang {jython | jacl} -username wasadmin -password password</pre></li>
            </ul>
        </ul>
    </div>

    <div class="step slide"  data-x="4500" data-y="3000">
        <h1>wsadmin - Change Default Language</h1>
        <ul>
            <li class="code"><pre class="brush: bash;gutter: false">edit {WAS_HOME}/profiles/Dmgr01/properties/wsadmin.properties</pre></li>
            <li>Default:</li>
            <ul>
                <li class="mono">com.ibm.ws.scripting.defaultLang=<span style="color:blue;font-weight:bold">JACL</span></li>
            </ul>
            <li>Change to:</li>
            <ul>
                <li class="mono">com.ibm.ws.scripting.defaultLang=<span style="color:blue;font-weight:bold">jython</span></li>
            </ul>
        </ul>
    </div>


    <div class="step slide" data-x="4500" data-y="4000">
        <h1>wsadmin - Credentials</h1>
        <ul>
            <li class="code"><pre class="brush: bash;gutter: false">{WAS_HOME}/profiles/Dmgr01/properties/soap.client.props</pre></li>
            <li class="important">Decreases Security (see next slide)</li>
            <ul>
                <li class="mono">com.ibm.SOAP.securityEnabled=true<br />
                com.ibm.SOAP.loginUserid=wasadmin<br />
                com.ibm.SOAP.loginPassword=password</li>
            </ul>
            <li class="code"><pre class="brush: bash;gutter: false">PropFilePasswordEncoder.sh soap.client.props com.ibm.SOAP.loginPassword</pre></li>
            <li class="mono">→ com.ibm.SOAP.loginPassword={xor}Lz4sLCgwLTs=</li>
        </ul>
    </div>

    <div class="step slide" data-x="4500" data-y="5000">
        <h1>WebSphere Password Decoding</h1>
        <ul>
            <li>Please do NOT store passwords in productive Environments!</li>
            <li>Passwords are simple XORed with "_" and base64 encoded</li>
            <li>Decryption:</li>
            <ul>
                <li>Several Webpages: e.g. <a href="http://www.sysman.nl/wasdecoder">http://www.sysman.nl/wasdecoder</a></li>
                <li class="code"  style="font-size:13px !important"><pre class="brush: bash;gutter: false">cd WAS_HOME</pre>
                <pre class="brush: java;gutter: false">java/jre/bin/java \</pre>
                <pre class="brush:java;gutter:false">-Djava.ext.dirs=deploytool/itp/plugins/com.ibm.websphere.v8_1.0.201.v20111031_1843/wasJars \</pre>
                <pre class="brush:java;gutter:false">-cp securityimpl.jar:iwsorb.jar com.ibm.ws.security.util.PasswordDecoder \</pre>
                <pre class="brush:java;gutter:false">"{xor}Lz4sLCgwLTs="</pre>
                <pre class="brush:java;gutter:false">encoded password == "{xor}Lz4sLCgwLTs=", decoded password == "password"</pre>
                </li>
            </ul>
        </ul>
    </div>

    <div class="step slide" id="ibmcnxload" data-x="4500" data-y="6000">
        <h1>Connections Administration Commands</h1>
        <ul>
            <li>Each application need it own commands:</li>
            <li class="code"><pre class="brush:jython;gutter:false"> execfile("connectionsConfig.py")</pre></li>
            <li>Create a script with all commands for preloading (see next slide)</li>
            <ul>
                <li>Call this script in your wsadmin session:</li>
                <li class="code"><pre class="brush: jython;gutter: false"> execfile("loadAll.py")</pre></li>
                <li>Add your script to com.ibm.ws.scripting.profiles in:</li>
                <ul>
                    <li class="code"><pre class="brush: bash;gutter: false">{WAS_HOME}/profiles/Dmgr01/properties/wsadmin.properties</pre></li>
                </ul>
                <li>Call wsadmin to execute the script</li>
                <li class ="code"><pre class="brush: bash;gutter: false">./wsadmin.sh -lang jython -profile loadAll.py</pre></li>
            </ul>
        </ul>
    </div>

    <div id="loadall" class="step slide" data-x="4500" data-y="7000">
        <h1>loadAll.py</h1>
        <pre class="brush: jython">
            execfile('connectionsConfig.py')
            execfile("activitiesAdmin.py")
            execfile("blogsAdmin.py")
            execfile("communitiesAdmin.py")
            execfile("dogearAdmin.py")
            execfile("filesAdmin.py")
            execfile("forumsAdmin.py")
            execfile("homepageAdmin.py")
            execfile("newsAdmin.py")
            execfile("profilesAdmin.py")
            execfile("wikisAdmin.py")
        </pre>
        <ul>
            <li>Save in:</li>
            <li class="code"><pre class="brush: bash;gutter: false">cd {WAS_HOME}/profiles/Dmgr01/bin</pre></li>
        </ul>
        <p class="alert">Caution: In multinode cluster environments you're asked on which server you want to work</p>
    </div>

    <div class="step slide" data-x="4500" data-y="8000">
        <h1>Jython</h1>
        <ul>
            <li>Easy to learn <span style="text-decoration: line-through">but</span> and powerful</li>
            <li>Python for the Java Platform</li>
            <ul>
                <li><a href="http://www.jython.org/jythonbook/en/1.0/">http://www.jython.org/jythonbook/en/1.0/ </a> </li>
                <li><a href="http://www.jython.org/docs/index.html">http://www.jython.org/docs/index.html </a></li>
            </ul>
            <li>Books</li>
            <ul>
                <li style="font-size:1.5em">WebSphere Application Server Administration Using Jython (2009)<br />
                Authors: Robert A. Gibson, Arthur Kevin McGrath and Noel J. Bergman</li>
                <li style="font-size:1.5em">The Definitive Guide to Jython: Python for the Java Platform (2010)<br />
                Authors: Josh Juneau, Frank Wierzbicki, Leo Soto and Victor Ng</li>
            </ul>
        </ul>
    </div>

    <div class="step slide" data-x="4500" data-y="9000">
        <h1>Web Ressources</h1>
        <ul>
            <li>Learn Python (similar to Jython)</li>
            <ul>
                <li>Great online courses on <a href="http://www.codecademy.com/">http://www.codecademy.com/</a> (Python, API, JavaScript)</li>
                <li><a href="http://learnpythonthehardway.org/book/">http://learnpythonthehardway.org/book/</a></li>
            </ul>
        </ul>
    </div>

    <div class="step slide nobg" data-x="6000" data-y="0">
        <h1>Jython basics: Defining variables</h1>
        <pre class="brush:jython">
        # Defining a String
        x = 'Hello World'
        x = "Hello World Two"

        #  Defining an integer
        y = 10

        #  Float
        z = 8.75

        # Complex
        i = 1 + 8.07j

        # Multiple assignment
        x, y, z = 1, 2, 3
        </pre>
    </div>

    <div class="step slide nobg" data-x="6000" data-y="1000">
        <h1>Jython basics: Ranges</h1>
        <pre class="brush:jython">
        wsadmin>range(7)
        [0, 1, 2, 3, 4, 5, 6]

        # Include a step in the range
        wsadmin>range(0,10,3)
        [0, 3, 6, 9]

        # Good base for loops
        wsadmin>range(1,11)
        [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]

        wsadmin>range(20,27)
        [20, 21, 22, 23, 24, 25, 26]
        </pre>
    </div>

    <div class="step slide nobg" data-x="6000" data-y="2000">
        <h1>Jython basics: Lists and dictionaries</h1>
        <pre class="brush:jython">
            #List
            wsadmin>dbs = ['activities','blogs','communities','dogear','files','forum']
            wsadmin>dbs[1]
            'blogs'
        </pre>
    </div>

    <div class="step slide nobg" data-x="6000" data-y="2300">
        <pre class="brush: jython">
            # Dictionary with Performance Data
            wsadmin>minConnections = {'activities':1,'blogs':1,'communities':10,'dogear':1}
            wsadmin>maxConnections = {'activities':50,'blogs':250,'communities':200}
            wsadmin>maxConnections
            {'communities': 200, 'activities': 50, 'blogs': 250}
            wsadmin>maxConnections.keys()
            ['communities', 'activities', 'blogs']
            wsadmin>maxConnections.values()
            [200, 50, 250]
            sadmin>maxConnections['blogs']
            250

        </pre>
    </div>

    <div class="step slide nobg" data-x="6000" data-y="3000">
        <h1>Jython basics: if - elif - else</h1>
        <ul>
            <li>Indent 4 spaces to group the code</li>
        </ul>
        <pre class="brush:jython">
          # Basic
          if condition :
              # print or do something
          elif other condition :
              # print or do something other
          else :
              # print or do completely different
        </pre>
    </div>
    <div class="step slide nobg" data-x="6000" data-y="3450">
        <pre class="brush:jython">
          # Example
          if value.find( 'CLFWY0217E' ) > -1 :
              print "\t\tuser already converted"
          elif value.find( 'CLFWY0212E' ) > -1 :
              print "\t\tuser not found in database"
          elif value.find( ' CLFWY0209E' ) > -1 :
              print "\t\tnew identifier '" + data[1] + "' does not exist."
          else :
              print '\t\tException value: ' + value
        </pre>
    </div>

    <div class="step slide nobg" data-x="6000" data-y="4200">
        <h1>Jython basics: Loops</h1>
        <pre class="brush:jython">
     # For Loops
     dbs = ['activities','blogs','communities','dogear','files','forum','homepage']
     for db in dbs: #loop through databases
         print "Database %s" % db

        </pre>
    </div>

    <div class="step slide nobg" data-x="6000" data-y="4500">
        <pre class="brush: jython">
     # While
     x = 0
     y = 3 
     while x <= y :
         print 'Value of x is: %d' %(x)
         x += 1
     else:
         print 'Completed!'

     Value of x is: 0
     Value of x is: 1
     Value of x is: 2
     Value of x is: 3
     Completed!
        </pre>
    </div>

    <div class="step slide" data-x="7500" data-y="0">
        <h1>Test Database Connection</h1>
        <ul>
            <li class="mono">checkDataSource.py</li>
            <pre class="brush: jython">
                # List of databases you want to check:
                dbs = ['activities','blogs','communities','dogear','files','forum','homepage']
                for db in dbs: #loop through databases
                    ds = AdminConfig.getid('/DataSource:' + db + '/')
                    checkDS = AdminControl.testConnection(ds)
                    if checkDS == "WASX7217I: Connection to provided datasource was successful." : 
                        print 'Connect to %s was successful' % db
                    else :
                        print 'Error: %s is not available' % db
            </pre>
            <li>Output:</li>
            <pre class="brush: jython;gutter: false">
                Connect to activities was successful
                Connect to blogs was successful
                Connect to communities was successful
                [...]
            </pre>
        </ul>
    </div>

    <div class="step slide nobg" data-x="7500" data-y="1000">
        <h1>Change DataSource Parameters</h1>
        <ul>
            <li class="mono">changeDataSource.py</li>
            <li>Setting Default Parameters as mentioned in <br /><a href="http://download.boulder.ibm.com/ibmdl/pub/software/dw/lotus/connections400/reference/IBM_Connections_4.0_Performance_Tuning_Guide_V1.0.pdf">IBM Connections 4.0 Performance Tuning Guide</a></li>
        </ul>
        <pre class="brush: jython">
            #Define a dictionary with database names and parameters

           perf = {'activities':{'minConnections':1,'maxConnections':50},
                'blogs':{'minConnections':1,'maxConnections':250},
                'communities':{'minConnections':10,'maxConnections':200},
                'dogear':{'minConnections':1,'maxConnections':150},
                'files':{'minConnections':10,'maxConnections':100},
                'forum':{'minConnections':50,'maxConnections':100},
                'homepage':{'minConnections':20,'maxConnections':100},
                ...
                'wikis':{'minConnections':1,'maxConnections':100}}

            statementCacheSize = 100 #change to 50 for oracle
        </pre>
    </div>


    <div class="step slide nobg" data-x="7500" data-y="1700">
        <pre class="brush: jython;wraplines: true;highlight:[1,4,8,9,11]">
            # perf.keys() gives a list of all databases in perf
            for db in perf.keys(): # Looping through databases, first values in dictionary
                # db.upper() convert the database name to capitals
                print 'Change DataSource parameters for: %s' % db.upper()

                t1=AdminConfig.getid('/DataSource:' + db + '/')
                print '  statementCacheSize: ' + str(statementCacheSize)
                print '  minConnections: ' + str(perf[db]['minConnections'])
                print '  maxConnections: ' + str(perf[db]['maxConnections'])
                AdminConfig.modify(t1,'[[statementCacheSize "' + str(statementCacheSize) + '"]]')
                AdminConfig.modify(t1,'[[connectionPool [[minConnections "' + str(perf[db]['minConnections']) + '"][maxConnections "' + str(perf[db]['maxConnections']) + '"]]]]')

                AdminConfig.save()
        </pre>
    </div>
    <div class="step slide subhead" data-x="7500" data-y="3000">
        <h1>Live Demo</h1>
    </div>

    <div class="step slide" data-x="7500" data-y="4000">
        <h1>memberService on all Applications</h1>
        <ul>
            <li class="mono">memberSyncByEmail.py</li>
            <pre class="brush: jython">
                MAILADDRESS = sys.argv[0]
                print "Syncing MemberService for " + MAILADDRESS
                execfile("/opt/install/scripts/loadAll.py")
                ActivitiesMemberService.syncMemberExtIdByEmail(MAILADDRESS)
                BlogsMemberService.syncMemberExtIdByEmail(MAILADDRESS)
                CommunitiesMemberService.syncMemberExtIdByEmail(MAILADDRESS)
                DogearMemberService.syncMemberExtIdByEmail(MAILADDRESS)
                FilesMemberService.syncMemberExtIdByEmail(MAILADDRESS)
                ForumsMemberService.syncMemberExtIdByEmail(MAILADDRESS)
                NewsMemberService.syncMemberExtIdByEmail(MAILADDRESS)
                WikisMemberService.syncMemberExtIdByEmail(MAILADDRESS)
            </pre>
            <li>Script reads MAILADDRESS as Parameter</li>
            <li class="code"><pre class="brush: bash;gutter: false">./wsadmin.sh –lang jython –f "memberSyncByEmail.py" "cstoettner@stoeps.local"</pre></li>
        </ul>
    </div>

    <div class="step slide nobg" data-x="7500" data-y="5000">
        <h1>SyncAllMember</h1>
        <pre class="brush:jython">

EmailMatch = sys.argv[0]

# Loading Connections Administration Commands
execfile("activitiesAdmin.py")
execfile("blogsAdmin.py")
execfile("communitiesAdmin.py")
execfile("dogearAdmin.py")
execfile("filesAdmin.py")
execfile("forumsAdmin.py")
execfile("homepageAdmin.py")
execfile("newsAdmin.py")
execfile("profilesAdmin.py")
execfile("wikisAdmin.py")

apps = ['Activities','Blogs','Communities','Dogear','Files','Forums','News','Wikis']

        </pre>
    </div>

    <div class="step slide nobg" data-x="7500" data-y="5550">
        <pre class="brush:jython;first-line: 17;">
def memService(appname,EmailMatch):
    if("Activities" == appname) :
        print "\tActivitiesMemberService.syncAllMembersByExtId"
        ActivitiesMemberService.syncAllMembersByExtId( {"updateOnEmailLoginMatch": EmailMatch } )
    elif("Blogs" == appname) :
        print "\tBlogsMemberService.syncAllMembersByExtId"
        BlogsMemberService.syncAllMembersByExtId( {"updateOnEmailLoginMatch": EmailMatch } )
    elif("News" == appname) :
        print "\tNewsMemberService.syncAllMembersByExtId"
        NewsMemberService.syncAllMembersByExtId( {"updateOnEmailLoginMatch": EmailMatch } )
    elif("Dogear" == appname) :
        print "\tDogearMemberService.syncAllMembersByExtId"
        DogearMemberService.syncAllMembersByExtId( {"updateOnEmailLoginMatch": EmailMatch } )
    elif("Communities" == appname) :
        print "\tCommunitesMemberService.syncAllMembersByExtId"
        CommunitiesMemberService.syncAllMembersByExtId( {"updateOnEmailLoginMatch": EmailMatch } )
    elif("Files" == appname) :
        print "\tFilesMemberService.syncAllMembersByExtId"
        FilesMemberService.syncAllMembersByExtId( {"updateOnEmailLoginMatch": EmailMatch } )
    elif("Forums" == appname) :
        print "\tForumsMemberService.syncAllMembersByExtId"
        ForumsMemberService.syncAllMembersByExtId( {"updateOnEmailLoginMatch": EmailMatch } )
    elif("Wikis" == appname) :
        print "\tWikisMemberService.syncAllMembersByExtId"
        WikisMemberService.syncAllMembersByExtId( {"updateOnEmailLoginMatch": EmailMatch } )
    else :
        print "\tUnknown application name '" + appname + "'"
        </pre>
    </div>

    <div class="step slide nobg" data-x="7500" data-y="6300">
        <pre class="brush:jython;first-line: 43;">

for app in apps:
    print "Sync all Members by EXTID for " + app
    memService(app, EmailMatch)


        </pre> 
    </div>

    <!-- Copy & Paste from Slides-->

    <div class="step slide" data-x="7500" data-y="7000">
        <h1>Backup Security Roles</h1>
        <pre class="brush: jython">
            apps = AdminApp.list()
            appsList = apps.split(lineSeparator) #List of all applications
            path = '/opt/install/backup' # must exist!
            for app in appsList:
                filename = app + ".txt"
                my_file = open(path + '/' + filename,'w')
                my_file.write (AdminApp.view(app,"-MapRolesToUsers"))
                my_file.flush
                my_file.close() 
        </pre>
        <ul>
            <li>Script creates a textfile with security role informations of each application</li>
            <li class="code"><pre class="brush: bash;gutter: false">./wsadmin.sh –lang jython –f "{path}/securityrolebackup.py" 'backuppath'</pre></li>
        </ul>
    </div>

    <div class="step slide nobg" data-x="7500" data-y="8000">
        <h1>Restore Security Roles</h1>
        <ul>
            <li>Script read textfile with security role informations of each application</li>
        </ul>
        <pre class="brush: jython">
import os
import sys

# Restore Security Role from Textfile (created with j2eerolebackup

path = sys.argv[0]
if path == '':
    path='../temp/j2eebackup' # path where Backup is stored
    print "Setting path to %s!" % path

if not os.path.exists(path):
    print "Path does not exists, please provide directory with your backup files!"
    sys.exit()

        </pre>
    </div>
    <div class="step slide nobg" data-x="7500" data-y="8600">
        <pre class="brush:jython;first-line:15">
def convertFile2Dict(appname):
    # function to convert backup txt files of Security Role Backup to a dictionary
    filename = path + '/' + appname + ".txt"
    myfile = open(filename,'r')

    count = 0
    dict = {}

    for line in myfile.readlines():
        # for loop through file to read it line by line
        if (':' in line) and (count > 12):
            value = line.split(':')[0]
            # cred = line.split(':')[1].strip('\n')
            cred = line.split(':')[1]
            # cred = cred.strip(' ')
            cred = cred.strip()
            if value == "Role":
                role = cred
                dict[role] = {}
            dict[role][value] = cred
        count += 1
    return dict

        </pre>
    </div>
    <div class="step slide nobg" data-x="7500" data-y="9300">
        <pre class="brush:jython;first-line:38">
def setSecurityRoles(dictionary,appName):
    strRoleChange = '['
    for role in dictionary.keys():
        # Loop through Roles
        strRoleChange += '[\"' + role + '\" '
        strRoleChange += dictionary[role]['Everyone?'] + ' '
        strRoleChange += dictionary[role]['All authenticated?'] + ' '
        strRoleChange += '\"' + dictionary[role]['Mapped users'] + '\" '
        strRoleChange += '\"' + dictionary[role]['Mapped groups'] + '\"] '
    strRoleChange += ']]'
    AdminApp.edit(appName, '[-MapRolesToUsers' + strRoleChange +']')
    print "Setting Roles and Users for %s" % appName
    AdminConfig.save()

apps = AdminApp.list()
appsList = apps.split(lineSeparator)
# Test with some Apps:
# appsList = ['Blogs','Activities','Wikis']
# or Single App:
# appsList = ['Blogs']
for app in appsList:
    # For testing: set app to example applicatio
    setSecurityRoles(convertFile2Dict(app),app)
print "Restore of Security Roles finished!"

        </pre>

    </div>

    <div class="step slide img" data-x="7500" data-y="10000">
        <video id="SecurityRoleDemo" width="976" height="608" preload controls>
            <source src="media/securityrolebackup2.ogv" autoplay/>
        </video>
    </div>
    <div class="step slide" data-x="7500" data-y="11000">
        <h1>Blogs about scripting</h1>
        <ul>
            <li>http://www.kbild.ch</li>
            <li>e.g. Set Default Security Roles and Restrict Roles to Administrators</li>
            <li>perfect to set initial security roles</li>
        </ul>
        <pre class="brush: jython">
            connwasadmin='wasadmin'
            connadmin='Admin1|Admin2'
            connmoderators='Moderator1|Moderator2'
            connmetrics='Metrics1|Metrics2'
            connmobile='Mobile1|Mobile2'

            appName='Activities'
            AdminApp.edit(appName, '[-MapRolesToUsers [["person" No Yes "" ""] ["everyone" Yes No "" ""] ["reader" Yes No "" ""] ["metrics-reader" No Yes "" ""] ["search-admin" No No "'+connwasadmin+'|'+connadmin+'" ""] ["widget-admin" No No "'+connwasadmin+'|'+connadmin+'" ""] ["admin" No No "'+connwasadmin+'|'+connadmin+'" ""] ["bss-provisioning-admin" No No "" ""] ]]')

            print "Setting Roles and Users for Activities"
            AdminConfig.save()
        </pre>
    </div>

    <div class="step slide subhead" data-x="9000" data-y="0">
        <h1>IBM DB2 Scripting</h1>
    </div>

    <div class="step slide" data-x="9000" data-y="1000">
        <h1>Useful commands </h1>
        <ul>
            <li>Get a list of all databases of an db2 instance</li>
            <ul>
                <li>Linux</li>
                <li class="code"><pre class="brush: bash;gutter:false">db2 list database directory | grep alias | awk '{print $4}' | sort</pre></li>
                <li>Windows (Powershell)</li>
                <li class="code">
                <pre class="brush: bash;gutter:false">db2cmd -i -c -w "db2 list database directory | where {$_ -match "alias"}\
                | %{ $_.Split('=')[1]; }"</pre>
                </li>
            </ul>
            <li>Show active databases</li>
            <ul>
                <li>Show active databases</li>
                <li class="code">
                <pre class="brush: bash;gutter:false">db2 list active databases</pre>
                </li>
            </ul>
        </ul>
    </div>

    <div class="step slide" data-x="9000" data-y="2000">
        <h1>Automatic maintenance</h1>
        <ul>
            <li>DB2 9.7 with export of Policy Files and reimport to other databases:</li>
            <li><a href="http://www.stoeps.de/skripting-db2-automatic-maintenance/">Skripting DB2 Automatic Maintenance | Stoeps</a>
            </li>
            <li>IBM Data Studio</li>
            <ul>
                <li>Configure Automatic maintenance and Backup on one database (eg homepage)</li>
                <li>Save commands to sql script</li>
            </ul>
        </ul>
    </div>

    <div class="step slide img" data-x="9000" data-y="2700">
        <img src="images/db2maint.png" />
    </div>

    <div class="step slide" data-x="9000" data-y="3000">
        <h1>Automatic maintenance (2)</h1>
        <ul>
            <li class="mono">automaint.sql </li>
            <ul>
                <li>copy the update line and the 4 CALL statements</li>
                <li>or download my automaint.sql and change the backup path (GitHub)</li>
            </ul>
            <li class="mono">setmaintenance.sh</li>
        </ul>
        <pre class="brush: bash">
        #!/bin/bash

        databases=$(db2 list database directory | grep alias | awk '{print $4}' | sort)

        for database in ${databases[@]}
        do
         echo $database
         db2 "connect to $database"
         db2 -tvf automaint.sql
         db2 "connect reset"
        done
        </pre>
    </div>

    <div class="step slide" data-x="9000" data-y="4000">
        <h1>Select EXID through applications</h1>
        <ul>
            <li>checkExID.sh</li>
            <li>Search any user by Email and get their ExID in each IBM Connections Application</li>
        </ul>
    </div>

    <div class="step slide nobg" data-x="9000" data-y="5000">
        <h1>Check ExId Bash Script</h1>
        <pre class="brush:bash">

if [ -z "$1" ]; then
    echo "USAGE: `basename $0` mailaddress"
    exit ;
fi


MAIL=$1

db2 -x "connect to peopledb" | grep alias | awk '{print $5}'
db2 -x "SELECT PROF_GUID, PROF_MAIL FROM EMPINST.EMPLOYEE WHERE PROF_MAIL_LOWER = '${MAIL,,}'"
db2 -x "connect reset" > /dev/null 
while true; do
    printf "Which email address should be used for Lookup?\n"
    read  MAIL
    break
done
        </pre>
    </div>

    <div class="step slide nobg" data-x="9000" data-y="5600">
        <pre class="brush:bash;first-line:17;highlight:[24,27]">
db2 -x "connect to OPNACT"| grep alias | awk '{print $5}'
db2 -x "select EXID from activities.oa_memberprofile where email = '$MAIL'"
db2 -x "connect reset" > /dev/null
db2 -x "connect to BLOGS"| grep alias | awk '{print $5}'
db2 -x "select EXTID from blogs.rolleruser where EMAILADDRESS = '$MAIL'"
db2 -x "connect reset" > /dev/null
db2 -x "connect to SNCOMM"| grep alias | awk '{print $5}'
db2 -x "select DIRECTORY_UUID from SNCOMM.MEMBERPROFILE where email = '${MAIL,,}'"
db2 -x "connect reset" > /dev/null
db2 -x "connect to dogear"| grep alias | awk '{print $5}'
db2 -x "select MEMBER_ID from DOGEAR.PERSON where email = '${MAIL,,}'"
db2 -x "connect reset" > /dev/null
db2 -x "connect to files"| grep alias | awk '{print $5}'
db2 -x "select DIRECTORY_ID from FILES.USER where email = '$MAIL'"
db2 -x "connect reset" > /dev/null
db2 -x "connect to forum" | grep alias | awk '{print $5}'
db2 -x "select EXID from FORUM.DF_MEMBERPROFILE where email = '$MAIL'"
db2 -x "connect reset" > /dev/null
db2 -x "connect to Homepage"| grep alias | awk '{print $5}'
db2 -x "select EXID from HOMEPAGE.PERSON where USER_MAIL = '$MAIL'"
db2 -x "connect reset" > /dev/null
db2 -x "connect to wikis"| grep alias | awk '{print $5}'
db2 -x "select DIRECTORY_ID from WIKIS.USER where email = '$MAIL'" | grep "-"
db2 -x "connect reset" > /dev/null


        </pre>
    </div>

    <div class="step slide img" data-x="9000" data-y="7000">
        <img src="images/checkExID.png" />
    </div>

    <div class="step slide subhead" data-x="10500" data-y="0">
        <h1>Some more</h1>
    </div>

    <div class="step slide" data-x="10500" data-y="1000">
        <h1>Get Root Certificate (e.g. selfsigned)</h1>
        <ul>
            <li>When you use LDAPS in TDI (or populationWizard), or Domino EE you need to trust the root certificate</li>
            <li>Prerequist: openssl, java (keytool)</li>
            <li>./create_cacerts.sh -h hostname -p port -f path/filename</li>
            <ul>
                <li>example: ./create_cacerts.sh -h mail.stoeps.local -p 636 -f /opt/install/keystore</li>
                <li>You have to provide a keystore password (twice) and trust cert</li>
            </ul>
            <li>TDIPopulation/solution.properties:<br />
            javax.net.ssl.trustStore=/opt/install/keystore</li>
        </ul>
    </div>

    <div class="step slide nobg" data-x="10500" data-y="2000">
        <h1>create_cacerts.sh</h1>
        <pre class="brush:bash">
        TMP1=`mktemp -d` 
        trap "rm -rf $TMP1" EXIT

        while getopts h:p:f:?: option
        do
            case "${option}"
                in
                h) SERVERNAME=${OPTARG};;
                p) SERVERPORT=${OPTARG};;
                f) STORECACERTS=${OPTARG};;
                ?) echo "USAGE: `basename $0` -h hostname -p port -f Certfile\n"
                echo "You have to type a password for keyfile twice and set\n"
                echo "the key to trusted!"
                exit
                ;;
            esac
        done

        if [ -z "$SERVERNAME" ] | [ -z "$SERVERPORT" ] | [ -z "$STORECACERTS" ] ; then
            echo "USAGE: `basename $0` -h hostname -p port -f Certfile"
            echo "You have to type a password for keyfile twice and set\n"
            echo "the key to trusted!"
            exit
        fi
        </pre>
    </div>
    <div class="step slide nobg" data-x="10500" data-y="2800">
        <pre class="brush:bash;fist-line:26">
        openssl s_client -showcerts -connect $SERVERNAME:$SERVERPORT < /dev/null > $TMP1/cst-key.out
        openssl x509 -outform DER < $TMP1/cst-key.out > $TMP1/cst-key.der
        openssl x509 -inform der -in $TMP1/cst-key.der -out $TMP1/cst-key.pem
        keytool -import -alias Selfsigned -keystore $STORECACERTS -file $TMP1/cst-key.pem
        </pre>
    </div>

    <div class="step slide subhead" data-x="12000" data-y="0">
        <h1>Ressources</h1>
    </div>

    <div class="step slide" data-x="12000" data-y="1000">
        <h1>Download the shown scripts</h1>
        <ul>
            <li>You can download all scripts (and some more) WITHOUT WARRENTY and on your own risk:</li>
        </ul>
        <h2><a href="https://github.com/stoeps13/ibmcnxscripting">https://github.com/stoeps13/ibmcnxscripting</a></h2>
        <ul>
            <li>There is much more:</li>
            <ul>
                <li>memberSyncAllByEXID.py, inactivate Users</li>
                <li>Create a printable version of Connections documentation</li>
                <li>Database backup, Lastlogon</li>
                <li>Change Monitoring Policy</li>
                <li>and so on</li>
            </ul>
        </ul>
    </div>

    <div class="step slide" data-x="12000" data-y="2000">
        <ul>
            <li>Future:</li>
            <ul>
                <li>create Powershell or Windows Batches</li>
                <li>scripts for basic troubleshooting</li>
                <li>add more error handling</li>
                <li>more documentation</li>
            </ul>
            <li>You're invited to work with these scripts, upload you're own</li>
            <li>Discuss with me through</li>
            <ul>
                <li>Skype: christophstoettner</li>
                <li>Twitter: @stoeps</li>
                <li>G+, Facebook, LinkedIn ...</li>
            </ul>
        </ul>
    </div>

    <div class="step slide subhead" data-x="12000" data-y="3000">
        <h1>Questions</h1>
    </div>

    <div class="step slide subhead" data-x="12000" data-y="4000">
        <h1>Thanks for listen</h1>
    </div>

    <!-- End Copy & Paste -->

    <!-- Overview Slide -->
    <div id="overview" class="step" data-x="4000" data-y="4000" data-scale="12">

    </div>

</div>


<!-- Loading JS Script files -->
<script src="js/impress.js"></script>
<script src="js/jquery.min.js"></script>
<script>
if ( !window.location.search.match(/print/) ) {
    impress().init();
}
</script>
</body>
</html>
